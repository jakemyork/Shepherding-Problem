function [GCMNeural,nil1,nil2] = GCMNetwork(sheepMatrixReshaped,x,y)
%MYNEURALNETWORKFUNCTION neural network simulation function.
% 
% Generated by Neural Network Toolbox function genFunction, 14-Sep-2018 13:29:30.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 40xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 2xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.00125060023128665;0.00114926967339157;0.00122539164942014;0.00121507765457855;0.00117474010932648;0.00121588281066939;0.000463368962835359;0.00113347328741641;0.00115818735164549;0.00129685573889824;0.00115959725875737;0.00114501526777482;0.000990827439515878;0.00126505789946412;0.00124798549861468;0.00127391109861588;0.0012578586555485;0.00134659380645272;0.000991673533665797;0.0011859091800466;0.00548126135302851;0.012672917098596;0.015546195311169;0.00494041094695954;0.00706734451408172;0.0113398010860185;0.0173047213211868;0.0144463221406564;0.0123090430898366;0.0144816669682325;0.00971867789606343;0.00741205292467515;0.0112264515733888;0.0146148495251787;0.00527553195138681;0.00712455851503506;0.0101131571967289;0.0100142489574006;0.0127204851889667;0.00954582795397568];
x1_step1.gain = [0.0133972260086214;0.0133508437870845;0.0133535096616825;0.0133643180381829;0.0133879424799635;0.0133726580639364;0.0133516017016828;0.0133698146031998;0.0133947326432868;0.013355037683198;0.0133470368400784;0.0133687068410568;0.0133617051044543;0.0133782382297113;0.0133689125752712;0.0133801751734821;0.0133648536889002;0.0133719593580365;0.0133524209551835;0.0133620033770565;0.0133790573414309;0.013408475065394;0.0133376713179102;0.0134350282522988;0.0133765444430827;0.0134253451900336;0.0134278790821029;0.0134069513350431;0.0133889833320044;0.0133857738819622;0.0133781302971858;0.0134053208395544;0.0133705311888867;0.013392274004563;0.0134016341278493;0.0134113845410685;0.0133906703748559;0.0134113318626736;0.0133924626295257;0.0133635113653211];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.6454330982291387464;0.86532711337021084308;-0.51053016548406982;0.0025765986135282336819;-0.27317610921611640284;-0.55191327881306340153;0.0486891806283576839;0.66955342260611039329;0.27374886158514954992;0.3383814430614334734;0.0037102289459825946519;0.49145936864180278514;-0.78624681682705088726;0.87223924783895312451;-1.328665548509155192;1.073287577432771478];
IW1_1 = [0.27005571789006349581 0.41083225525035027559 -0.20933777096693084729 -0.068518157362951637168 0.35150314035219654141 -0.30778805415499271847 -0.19162173401582474619 -0.046249385803393196215 0.026922135474636909452 -0.062889040393056178102 -0.18551437716187799132 -0.23691189515688890199 0.30475471960631606017 0.163470046744628561 0.54848328475089846989 0.14938361353968221401 0.0075238796525864872627 -0.24571176765862245972 0.17971953041918989347 0.32705105196948974777 0.14708556039492695633 -0.11714951342831658732 0.44077858685922005622 -0.31381089998479133607 -0.038341056140005373709 -0.14910133122890628643 0.40948663589759837222 -0.47642597541498371561 -0.21336747231019201343 -0.024755704782580864598 0.41861782304564731927 0.10744403105151635602 -0.084245308015561501391 -0.43525359075595521086 -0.24899552815104983305 0.35852758263461692589 -0.026424822636161721112 -0.1390818325091110752 -0.30517376219109298985 -0.13096768435614161707;0.019854033671710711456 0.019919727962320915582 0.019910579246415864574 0.019908638124926089641 0.01986173630784226346 0.019899174237255859432 0.019928117717583723745 0.019893672239292545245 0.019855643570354044453 0.019916883796005997037 0.019923868879583042646 0.019896986100069846692 0.019902149238212714366 0.019874971698824957927 0.019897340733570127724 0.019878031325674498653 0.019900255524910370752 0.019897521484284197424 0.019915467301332593492 0.019914995116713369444 0.00014944758034692300509 0.00014432749099392840563 0.00014771560029146131891 0.00014597218779610049281 0.00014511967475230527639 0.00014865630025420140613 0.00014829837084332677245 0.00014283882539729107351 0.00014392956522898001852 0.00014571352009070000482 0.00015045549547420237904 0.00014807841170836276955 0.0001536032338054593271 0.00014996550513658271392 0.00015108363339420260974 0.00014470261555919267321 0.0001480002261289331707 0.00015036195107186167957 0.00015006641776409184374 0.000145200488042686375;0.014114092703551519084 0.014162104604776567379 0.01415602882295522412 0.01414966077098662664 0.014126119166355852186 0.014142301436950900292 0.01415995777115434083 0.014138825546006600006 0.014113137081879455897 0.014158051940124647891 0.01416438240070040655 0.014145056126511894312 0.014151642745911494764 0.01413096108161020388 0.014142131454836772905 0.014128828680664643966 0.014149836322959968501 0.014137765522797517137 0.01416153948146859666 0.014147991825298902521 0.00010176058118315010979 0.00010349118571651465183 0.00010887941871454098438 0.00010203486722353635621 0.00010417528096142686486 0.00010494654874100429044 0.00010183625656811964703 0.00011209165153731476272 0.0001044859162864080626 0.0001048162906795215303 0.00010448657878162374499 0.0001083419534997731408 0.00010300375572882582154 0.00010275323385859708929 0.00010561936327423191004 0.00010474917262942287828 0.00010382756515196543505 0.00010690598726198348954 0.00010376742659274169271 0.00010645699721278566662;0.00038546692526002267806 0.00046081254836661373307 0.00050295796427972394322 0.00067169112675695159115 0.00053543683945929735051 0.00049425137596962860718 0.00083543184536200433381 0.00065136689253756784469 0.00068055870585319300486 0.00049307146983110770357 0.00071810925579949473705 0.00060361109309443113525 0.00087377986178012153132 0.0004876746585304881222 0.00057163801544298713068 0.00064163468798891028395 0.0006529185182371478012 0.00051717864844241117663 0.00043137193023468284932 0.00042662018231588884473 0.011054101768150505214 0.010151206081282792421 0.010512438672018528316 0.010179935602828305702 0.010482227741550210337 0.010152700227345821601 0.010453695561654697405 0.010331989693344987083 0.010208970866772578562 0.010374545965637856776 0.011023553745600064499 0.010472181211021242692 0.010282180343073441323 0.010811235101730272412 0.010845918985279683761 0.010130097491463638248 0.010283983643996812488 0.010898769090394619732 0.010455262246214375166 0.01034923390963317022;-0.098499630869622420426 -0.08924300724998973644 -0.13110695341707753747 -0.13343120266043295707 -0.10881432141672672809 -0.089019251312125124986 -0.17053897657607955396 -0.16775910480521788459 -0.14003768667584473584 -0.16563103095587133895 -0.14882048627129942919 -0.068799797411285334992 -0.083975021207421035596 -0.1107568970540034059 -0.10501681204871594899 -0.14318430874835008648 -0.11923265791200421404 -0.12465596233621308031 -0.082829386248145009386 -0.17858809343523396329 -0.027369394549526006311 -0.018155804912558564518 0.031583458225831008426 -0.010003180104280608859 0.0042013424428862175541 -0.026342251322430659116 -0.045156645437781105235 0.062082107112544658578 0.017675691261232209794 0.0032182433317061039622 -0.011707241124395442039 0.050814020884672739253 -0.014967987045195228074 -0.059788636036716871769 -0.058362911646539887556 0.031617153774589935866 -0.0089363117239951387477 0.055949842485045801765 -0.041535677537680747162 0.033518331793682021313;0.8516306578157469831 0.74947153136985034116 -0.530832910810093761 0.51944161727888849001 0.70579228412211125754 -0.81455722875686398243 -0.78953790719730410075 0.1027182539424034563 0.2313131723027168074 0.01273091000640070268 0.53489546491233375125 -0.45579287974081483803 0.15932928052389627727 0.6032150297898086766 0.5616220291350664251 0.18456033091478829533 -0.12158063407788613497 0.14438476091310262217 0.088207278818145107291 -0.6853971469983061171 -0.34567477178062433474 -0.38427536850806198743 0.68436711088247847989 -0.22233157975789083483 -0.78919901510063994454 -0.5887825678083058456 0.83943519575507519193 -0.33034781077720504205 -0.39830832920586600743 -0.39981500246514273256 0.98395281686461821824 0.53431050243687161494 -0.46428276445642957526 -0.57200944455333602168 -0.52159841204843249152 0.81252578547417297905 0.57527205746343479387 -0.63083529278103533944 -0.28459578528187445823 0.19863250473614940672;-0.15632938233849294485 0.17868005204166401145 0.25560629599598932993 -0.36456585689832810004 -0.1336565284988900093 -0.29574411546902168446 -0.23090822948050429564 0.13851014722714952154 -0.065356265759212120448 -0.070361996937731458024 0.099954550213251891488 0.10269803076816938492 0.25413339507672516593 0.19877579227728800482 0.22571029948795062747 -0.24237748878239917527 -0.078644085019783302459 -0.078235982911783075178 0.15021155418782181079 -0.11792028175677633783 0.0019084784821368943383 0.17882711567972878197 0.057142460313606056876 -0.038529144561501624255 -0.12801859062184278715 -0.15288294939475013945 0.058323790570193774496 -0.16186975975971698571 0.17466100599258008175 0.19284790950999433634 -0.37051961285086076892 0.25542494946159954861 -0.11367406937288995761 0.26862890829957741801 -0.1811747428057311482 -0.19997081012906606223 -0.13694840702842586699 0.17522855039356247109 0.10369011233938973948 0.055014637755250055118;-0.00084309299701313138078 -0.00081234791187563461928 -0.00079217969451049583159 -0.00069607871485280622091 -0.00076662288591138494798 -0.00079213665559603159763 -0.0006154435207221914091 -0.00071141336945120057633 -0.0006928097414442742092 -0.00079249754527263409094 -0.00067513264610481054945 -0.00073378035241133217001 -0.00059748143572000333903 -0.00079253314187476085056 -0.00074923544948314710519 -0.00071864830289100189303 -0.00071319514092315640895 -0.000780644585741497774 -0.00082556714260981700019 -0.0008268249687785435894 -0.01264973362807817088 -0.013078441476256403783 -0.012985061338578008511 -0.013025922208279076819 -0.012946042594312846818 -0.013049259974487938812 -0.012890108264520416803 -0.012984324727608511849 -0.013070910576802022632 -0.012992228374220624737 -0.012670728774155414278 -0.012913410952379559063 -0.013055546904317384335 -0.012757606213010202686 -0.012727879143229640924 -0.013082391211825923627 -0.013030431141894604011 -0.012677721138617007932 -0.012943506577676577168 -0.013039103258214151254;0.22777300994593022154 0.15746855495353215271 0.092936511268795179985 -0.071497919124152237158 0.053338656694342963249 0.029968408516949353315 -0.13923446556872820512 -0.19690966645707513871 -0.2526359753534957453 0.16834079816494956772 -0.089317491460365577849 -0.056207397155352251117 -0.15201460911806782828 0.053431080509249780086 0.19638371201277482481 -0.018390177207261777792 0.091164060027801183117 0.17934583172479920399 0.026084107786165228876 0.2400244704789549488 0.22796139625925754268 -0.07201318154290438367 -0.03625304577500198383 -0.17473395217517154188 -0.061555712267072945632 0.022660863847774527502 0.065171504386275294629 0.17174481147102682588 -0.26598956632065251515 0.24367386543439878421 0.19243627591136111543 0.06828262236437847299 -0.29954974226368513701 -0.29855424427644000618 0.23418657804136217004 0.028780934408557969778 -0.17408260410183121203 -0.080117087425439215131 0.24394981194948958669 -0.13168188307259823255;0.22890815895513644262 0.33645171093083392488 0.19514434632460700425 0.028406862613002955426 0.20640634686465209047 0.19215530516170456488 -0.12627415640546693631 -0.10072332898237440491 0.091097859152719076747 -0.07488045840075339965 0.05550882449655302614 0.36415618634535723563 0.35000396571888026109 0.25402290191030624245 0.24173409421977648526 0.065922796044219314493 0.038100373089318503861 0.056364137355910379212 0.29759933989964021395 -0.17991414676393596705 -0.058692209893142284483 -0.10434515885962993009 0.18077771135749839959 -0.028268594744206967939 0.025049730467316087823 -0.18688634242501339644 -0.19751321479094016698 0.25520273563413875539 0.097613152804975095167 0.014638640423779315097 -0.013026203441466962032 0.22496134248629681696 -0.022688225338940500031 -0.29155453237531003818 -0.31255255651528196514 0.16271862651877344597 -0.015801851074030048155 0.28872089849311838305 -0.24114465566253848183 0.17647904601753677811;0.043808978896198953745 -0.018621992649026735539 0.081632013261281916039 -0.11437682267391918733 -0.057413802488597572016 -0.14779286300828015088 -0.10181915323706469678 0.092662163098793229321 0.040361069428703183481 -0.10786071464110905116 0.01347515894463850554 -0.10139820741514576907 -0.082507025214041823657 0.12164553133751367098 -0.076074346466719552917 0.075407124392256386081 0.094727559541625636075 0.091094944303710956302 0.10466018500438459271 -0.081445363129144604519 0.082300748965440692628 0.12808431259824773485 -0.20424354865195931685 0.1365386416152306881 0.16040974470418789544 0.044222470009904223109 0.089508925469729980207 -0.12758371108656527126 0.071360571251888424427 0.062733955665023238835 0.03098095517635945581 -0.19043465476193127683 -0.11740302469960602061 -0.050090546068469188334 -0.052935593542340328432 0.16554862555196875329 0.0446983308777631691 -0.22912302212035179361 0.074694172324870564128 -0.00054474392469646207293;0.30288741448983846904 -0.027099894595914796047 -0.29646014116585561737 0.1859343389894143328 0.14991627522299189046 0.23959657221667512994 -0.51578841113016093978 -0.02449538787327170189 -0.44352609104952456232 0.40392078302080297592 0.12895342446567642503 0.10148991969699970583 -0.28331989744395019715 0.21905096215781894031 0.036782776150618028133 -0.25015009174228913791 -0.01771390929768345765 0.23978206029202187022 0.072801564789763684171 0.2336129918679105133 -0.2325139969375115967 0.14849989788318027073 -0.044141704441868240272 0.40206224888003083695 0.39073062133278019248 0.3965661011380428036 0.2289022576730249392 0.28330272544023388237 0.40874937331749766622 -0.011070012997288901369 -0.22196112062084530359 0.1473057314116787142 0.35936880828220851836 -0.33445280405652372258 -0.38207602933774159615 0.37968488615940648723 0.26579224991203692641 0.10747098556252812629 0.23807360394372734103 0.14818961517827058949;-0.25008919680577479383 0.18687593549822123506 -0.32472199818556524153 -0.34307644900419953515 0.067826281649844388788 0.076751549021520495963 -0.25345100857178315401 0.14571842850265295799 -0.089779977165638596981 -0.017328972024180794298 -0.052510014169510670079 0.31772273599490186147 0.33929651927038684267 0.24432482254331930327 -0.16380188619480801071 -0.08960948300190703375 0.33006341572992631272 0.38818076542935048279 0.21304858734235820883 0.12172670773660815291 0.26217165656695978759 -0.19052239145408125798 0.061090484056531633994 0.33980224906396572226 -0.20182025033803926983 0.09572913146093287029 -0.20492493460462479771 -0.010260750306203828691 -0.18281180721063725048 0.18743570501798495487 -0.049365283925538190613 -0.13740313681445426308 -0.21842803144469233323 -0.021424763945760705308 -0.11933592898923507664 0.068059519185580744094 -0.0037746406319188745455 0.17212162267434641394 -0.029051853039071089124 0.057057935584895441705;0.0010175373180594201629 0.00097403705031974953214 0.00095584222298106757097 0.00085599945469761265244 0.00093116486686382568018 0.00094478197811124109591 0.00076408091785345913331 0.00087139615999627651182 0.00085563561304850181775 0.00095090465571619296054 0.00083501937331414836149 0.00089560886965014605259 0.00073429501508697771726 0.00096739703777694969426 0.00091069199319228810903 0.00086744728047207333207 0.00086748174080307418211 0.00094222993108893603447 0.00099387501932501898239 0.00098697626762370756909 0.015396995391767490102 0.015873463665802854672 0.0157713058227913136 0.015812084917796221523 0.015740335960002471011 0.015846804242502950805 0.015670456224426650149 0.015757917182787746502 0.01587328810434202736 0.015778453380419211333 0.015411436346859487892 0.015680321190992673602 0.015859272598890822997 0.015516361153849498461 0.015474420157547907895 0.015886831187326495157 0.015826106007430913031 0.015435952442410994304 0.015714356529899473763 0.015819262795484359541;-0.092696598885155898073 0.017462529921723583815 -0.30397616154516926557 -0.12020684059725160464 -0.19140584772076621456 0.33044422351152197281 0.055551879286378620659 -0.22725748893167382891 -0.2801865655445852088 0.12569897773598867619 -0.17660948343603019572 -0.27629773024954351612 0.34187906597240452777 -0.35248508751082352486 -0.018034786779519872829 0.34097155936449230484 0.00078401430749301475286 0.10634227368881654652 0.17658345608392497783 0.31468961875465556455 0.15553864477367443375 -0.23513140376194519021 -0.11054010381154155684 -0.068414364495432228308 -0.28373451994429782497 -0.34087360679911066219 -0.30973834821359785829 0.12785477971287761978 -0.26564140837564154118 -0.079008129931351006592 0.17119653208201696115 0.16072505251446675412 -0.41562542194510171401 -0.18299547468585541932 0.22262997729277000936 -0.39178728226841075255 -0.2376213167742311505 -0.20593415834726094826 0.24484053995342558441 0.23883549624178262993;0.18855588302675874157 0.18036915661631292007 0.38619320521122063594 -0.26746322049458765013 0.060801827279195183595 -0.091290343203781459946 0.12751153676706042384 -0.036684993773376008142 0.3075013979636496142 -0.23727730732870716546 -0.26388496363061769712 -0.26082902016553910496 -0.20590766462987775132 0.023006740257509494113 0.13113371559524605869 0.22963961751203873507 -0.22178116271371617341 -0.067591341659438156086 0.35386278490187927925 0.14908988957490212912 0.07351417199603618724 0.53738959632717897552 0.4179640930985530356 0.33309396924510553673 0.065313459137772922336 0.44702236259453864697 0.2955233526780293718 0.36462267473110576699 0.31582887238373569261 0.54728644921588542882 -0.082474875745459766407 0.18288982877074622113 0.3022496306290408663 0.27690679520517286205 0.33160580192889799189 0.37962707588713956453 0.36740418385507073173 -0.16263120862082014462 0.21087763494891320626 0.4404021869335651429];

% Layer 2
b2 = [0.34033127193091822216;0.1616976990643510248];
LW2_1 = [-8.0482834442689360983e-07 1.5808189582852190114 3.0752351758337006515 -0.01065299353337604768 -0.00058597708350582736539 -8.6408572891502133562e-07 9.3574592610938666114e-06 0.018150777077274034277 -4.748678931149567247e-06 0.00011082150795392196798 3.7078828388346674353e-05 -2.4580375706863821696e-07 1.3186314892534557077e-06 -0.013261853650499574875 4.1435442691531763584e-07 3.3446116862351296342e-07;3.4446221607036852641e-08 -0.090538903522154615122 -0.17612359628735388406 1.4006901723728852893 3.3045295273332456524e-05 7.4252354948154719457e-07 7.715460986210435813e-07 -2.4827539468187986849 2.4707116793764879626e-06 -7.8198805747163217068e-06 -4.8064565253353387002e-05 3.8858358729508974674e-05 -1.0553049645893609594e-06 1.8078549988504790669 1.6889768687411046532e-05 4.5204275974793483163e-05];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.0133716704733847;0.0134390209276308];
y1_step1.xoffset = [0.00119239540528857;0.0137152197738708];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(sheepMatrixReshaped);
if ~isCellX
    sheepMatrixReshaped = {sheepMatrixReshaped};
end

% Dimensions
TS = size(sheepMatrixReshaped,2); % timesteps
if ~isempty(sheepMatrixReshaped)
    Q = size(sheepMatrixReshaped{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
GCMNeural = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(sheepMatrixReshaped{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    GCMNeural{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
nil1 = cell(1,0);
nil2 = cell(2,0);

% Format Output Arguments
if ~isCellX
    GCMNeural = cell2mat(GCMNeural);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
